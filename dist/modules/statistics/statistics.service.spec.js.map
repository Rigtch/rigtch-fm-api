{"version":3,"sources":["../../../src/modules/statistics/statistics.service.spec.ts"],"sourcesContent":["import { test, describe, expect, beforeEach, vi } from 'vitest'\nimport { HttpService } from '@nestjs/axios'\nimport { TestingModule, Test } from '@nestjs/testing'\nimport { firstValueFrom, of } from 'rxjs'\n\nimport { StatisticsService } from './statistics.service'\n\nimport {\n  spotifyTrackMock,\n  formattedTracksMock,\n  spotifyArtistsMock,\n  formattedArtistsMock,\n  topGenresMock,\n  spotifyTracksMock,\n  spotifyArtistMock,\n  formattedArtistMock,\n  spotifyAudioFeaturesMock,\n  analysisMock,\n} from '@common/mocks'\nimport { axiosResponseMockFactory } from '~/utils'\n\ndescribe('StatisticsService', () => {\n  let statisticsService: StatisticsService\n  let httpService: HttpService\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        StatisticsService,\n\n        {\n          provide: HttpService,\n          useValue: {\n            get: vi.fn(),\n          },\n        },\n      ],\n    }).compile()\n\n    statisticsService = module.get<StatisticsService>(StatisticsService)\n    httpService = module.get<HttpService>(HttpService)\n  })\n\n  test('should be defined', () => {\n    expect(statisticsService).toBeDefined()\n  })\n\n  test('should get last tracks', async () => {\n    vi.spyOn(httpService, 'get').mockReturnValue(\n      of(\n        axiosResponseMockFactory({\n          items: Array.from({ length: 5 }).map(() => ({\n            track: spotifyTrackMock,\n            played_at: '2022-11-26T11:01:10.040Z',\n          })),\n        })\n      )\n    )\n\n    expect(await firstValueFrom(statisticsService.lastTracks('awd'))).toEqual(\n      formattedTracksMock\n    )\n  })\n\n  test('should get top artists', async () => {\n    vi.spyOn(httpService, 'get').mockReturnValue(\n      of(axiosResponseMockFactory({ items: spotifyArtistsMock }))\n    )\n\n    expect(await firstValueFrom(statisticsService.topArtists('awd'))).toEqual(\n      formattedArtistsMock\n    )\n  })\n\n  test('should get top genres', async () => {\n    vi.spyOn(httpService, 'get').mockReturnValue(\n      of(\n        axiosResponseMockFactory({\n          items: spotifyArtistsMock,\n        })\n      )\n    )\n\n    expect(await firstValueFrom(statisticsService.topGenres('awd', 3))).toEqual(\n      topGenresMock\n    )\n  })\n\n  test('should get top tracks', async () => {\n    vi.spyOn(httpService, 'get').mockReturnValue(\n      of(\n        axiosResponseMockFactory({\n          items: spotifyTracksMock,\n        })\n      )\n    )\n\n    expect(await firstValueFrom(statisticsService.topTracks('awd'))).toEqual(\n      formattedTracksMock\n    )\n  })\n\n  test('should get artist with given id', async () => {\n    vi.spyOn(httpService, 'get').mockReturnValue(\n      of(axiosResponseMockFactory(spotifyArtistMock))\n    )\n\n    expect(\n      await firstValueFrom(statisticsService.artist('awd', 'some id'))\n    ).toEqual(formattedArtistMock)\n  })\n\n  test('should generate analysis', async () => {\n    vi.spyOn(statisticsService, 'topTracks').mockReturnValue(\n      of(formattedTracksMock)\n    )\n\n    vi.spyOn(httpService, 'get').mockReturnValue(\n      of(\n        axiosResponseMockFactory({\n          audio_features: [spotifyAudioFeaturesMock],\n        })\n      )\n    )\n\n    expect(await firstValueFrom(statisticsService.analysis('awd'))).toEqual(\n      analysisMock\n    )\n  })\n})\n"],"names":["describe","statisticsService","httpService","beforeEach","module","Test","createTestingModule","providers","StatisticsService","provide","HttpService","useValue","get","vi","fn","compile","test","expect","toBeDefined","spyOn","mockReturnValue","of","axiosResponseMockFactory","items","Array","from","length","map","track","spotifyTrackMock","played_at","firstValueFrom","lastTracks","toEqual","formattedTracksMock","spotifyArtistsMock","topArtists","formattedArtistsMock","topGenres","topGenresMock","spotifyTracksMock","topTracks","spotifyArtistMock","artist","formattedArtistMock","audio_features","spotifyAudioFeaturesMock","analysis","analysisMock"],"mappings":"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"}