{"version":3,"sources":["../../../src/modules/statistics/statistics.controller.spec.ts"],"sourcesContent":["import { test, describe, expect, beforeEach, vi } from 'vitest'\nimport { Test, TestingModule } from '@nestjs/testing'\nimport { firstValueFrom, of } from 'rxjs'\n\nimport { StatisticsController } from './statistics.controller'\nimport { StatisticsService } from './statistics.service'\n\nimport {\n  analysisMock,\n  formattedArtistMock,\n  formattedArtistsMock,\n  formattedTrackMock,\n  formattedTracksMock,\n  spotifyResponseMockFactory,\n  topGenresMock,\n} from '@common/mocks'\n\ndescribe('StatisticsController', () => {\n  let statisticsController: StatisticsController\n  let statisticsService: StatisticsService\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        StatisticsController,\n        {\n          provide: StatisticsService,\n          useValue: {\n            lastTracks: vi.fn(),\n            topTracks: vi.fn(),\n            topGenres: vi.fn(),\n            topArtists: vi.fn(),\n            artist: vi.fn(),\n            analysis: vi.fn(),\n          },\n        },\n      ],\n    }).compile()\n\n    statisticsController =\n      module.get<StatisticsController>(StatisticsController)\n    statisticsService = module.get<StatisticsService>(StatisticsService)\n  })\n\n  test('should be defined', () => {\n    expect(statisticsController).toBeDefined()\n  })\n\n  describe('LastTracks', () => {\n    test('should get last tracks', async () => {\n      vi.spyOn(statisticsService, 'lastTracks').mockReturnValue(\n        of(formattedTracksMock)\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.lastTracks('awd', {}))\n      ).toEqual(formattedTracksMock)\n    })\n\n    test('should get last tracks with limit query', async () => {\n      const limit = 20\n\n      const formattedTracksWithLimitMock = Array.from(\n        { length: limit },\n        () => formattedTrackMock\n      )\n\n      vi.spyOn(statisticsService, 'lastTracks').mockReturnValue(\n        of(formattedTracksWithLimitMock)\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.lastTracks('awd', { limit }))\n      ).toEqual(formattedTracksWithLimitMock)\n    })\n  })\n\n  describe('TopTracks', () => {\n    test('should get top tracks', async () => {\n      vi.spyOn(statisticsService, 'topTracks').mockReturnValue(\n        of(spotifyResponseMockFactory(formattedTracksMock))\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.topTracks('awd', {}))\n      ).toEqual(spotifyResponseMockFactory(formattedTracksMock))\n    })\n\n    test('should get top tracks with limit query', async () => {\n      const limit = 20\n\n      const formattedTracksWithLimitMock = Array.from(\n        { length: limit },\n        () => formattedTrackMock\n      )\n\n      vi.spyOn(statisticsService, 'topTracks').mockReturnValue(\n        of(spotifyResponseMockFactory(formattedTracksWithLimitMock))\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.topTracks('awd', { limit }))\n      ).toEqual(spotifyResponseMockFactory(formattedTracksWithLimitMock))\n    })\n  })\n\n  describe('TopGenres', () => {\n    test('should get top genres', async () => {\n      vi.spyOn(statisticsService, 'topGenres').mockReturnValue(\n        of(topGenresMock)\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.topGenres('awd', {}))\n      ).toEqual(topGenresMock)\n    })\n\n    test('should get top genres with limit argument', async () => {\n      const limit = 20\n\n      const genresWithLimitMock = {\n        genres: Array.from({ length: limit }, () => 'genre'),\n      }\n\n      vi.spyOn(statisticsService, 'topGenres').mockReturnValue(\n        of(genresWithLimitMock)\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.topGenres('awd', { limit }))\n      ).toEqual(genresWithLimitMock)\n    })\n  })\n\n  describe('TopArtists', () => {\n    test('should get top artists', async () => {\n      vi.spyOn(statisticsService, 'topArtists').mockReturnValue(\n        of(spotifyResponseMockFactory(formattedArtistsMock))\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.topArtists('awd', {}))\n      ).toEqual(spotifyResponseMockFactory(formattedArtistsMock))\n    })\n\n    test('should get top artists with limit argument', async () => {\n      const limit = 20\n\n      const formattedArtistsWithLimitMock = Array.from(\n        { length: limit },\n        () => formattedArtistMock\n      )\n\n      vi.spyOn(statisticsService, 'topArtists').mockReturnValue(\n        of(spotifyResponseMockFactory(formattedArtistsWithLimitMock))\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.topArtists('awd', { limit }))\n      ).toEqual(spotifyResponseMockFactory(formattedArtistsWithLimitMock))\n    })\n  })\n\n  test('should get artist', async () => {\n    vi.spyOn(statisticsService, 'artist').mockReturnValue(\n      of(formattedArtistMock)\n    )\n\n    expect(\n      await firstValueFrom(statisticsController.artist('awd', '123'))\n    ).toEqual(formattedArtistMock)\n  })\n\n  test('should get analysis', async () => {\n    vi.spyOn(statisticsService, 'analysis').mockReturnValue(of(analysisMock))\n\n    expect(await firstValueFrom(statisticsController.analysis('awd'))).toEqual(\n      analysisMock\n    )\n  })\n})\n"],"names":["describe","statisticsController","statisticsService","beforeEach","module","Test","createTestingModule","providers","StatisticsController","provide","StatisticsService","useValue","lastTracks","vi","fn","topTracks","topGenres","topArtists","artist","analysis","compile","get","test","expect","toBeDefined","spyOn","mockReturnValue","of","formattedTracksMock","firstValueFrom","toEqual","limit","formattedTracksWithLimitMock","Array","from","length","formattedTrackMock","spotifyResponseMockFactory","topGenresMock","genresWithLimitMock","genres","formattedArtistsMock","formattedArtistsWithLimitMock","formattedArtistMock","analysisMock"],"mappings":";;;;wBAAuD;yBACnB;sBACD;sCAEE;mCACH;uBAU3B;AAEPA,IAAAA,gBAAQ,EAAC,wBAAwB;IAC/B,IAAIC;IACJ,IAAIC;IAEJC,IAAAA,kBAAU,EAAC;QACT,MAAMC,SAAwB,MAAMC,aAAI,CAACC,mBAAmB,CAAC;YAC3DC,WAAW;gBACTC,0CAAoB;gBACpB;oBACEC,SAASC,oCAAiB;oBAC1BC,UAAU;wBACRC,YAAYC,UAAE,CAACC,EAAE;wBACjBC,WAAWF,UAAE,CAACC,EAAE;wBAChBE,WAAWH,UAAE,CAACC,EAAE;wBAChBG,YAAYJ,UAAE,CAACC,EAAE;wBACjBI,QAAQL,UAAE,CAACC,EAAE;wBACbK,UAAUN,UAAE,CAACC,EAAE;oBACjB;gBACF;aACD;QACH,GAAGM,OAAO;QAEVnB,uBACEG,OAAOiB,GAAG,CAAuBb,0CAAoB;QACvDN,oBAAoBE,OAAOiB,GAAG,CAAoBX,oCAAiB;IACrE;IAEAY,IAAAA,YAAI,EAAC,qBAAqB;QACxBC,IAAAA,cAAM,EAACtB,sBAAsBuB,WAAW;IAC1C;IAEAxB,IAAAA,gBAAQ,EAAC,cAAc;QACrBsB,IAAAA,YAAI,EAAC,0BAA0B;YAC7BT,UAAE,CAACY,KAAK,CAACvB,mBAAmB,cAAcwB,eAAe,CACvDC,IAAAA,QAAE,EAACC,0BAAmB;YAGxBL,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBW,UAAU,CAAC,OAAO,CAAC,KAC7DkB,OAAO,CAACF,0BAAmB;QAC/B;QAEAN,IAAAA,YAAI,EAAC,2CAA2C;YAC9C,MAAMS,QAAQ;YAEd,MAAMC,+BAA+BC,MAAMC,IAAI,CAC7C;gBAAEC,QAAQJ;YAAM,GAChB,IAAMK,yBAAkB;YAG1BvB,UAAE,CAACY,KAAK,CAACvB,mBAAmB,cAAcwB,eAAe,CACvDC,IAAAA,QAAE,EAACK;YAGLT,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBW,UAAU,CAAC,OAAO;gBAAEmB;YAAM,KACpED,OAAO,CAACE;QACZ;IACF;IAEAhC,IAAAA,gBAAQ,EAAC,aAAa;QACpBsB,IAAAA,YAAI,EAAC,yBAAyB;YAC5BT,UAAE,CAACY,KAAK,CAACvB,mBAAmB,aAAawB,eAAe,CACtDC,IAAAA,QAAE,EAACU,IAAAA,iCAA0B,EAACT,0BAAmB;YAGnDL,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBc,SAAS,CAAC,OAAO,CAAC,KAC5De,OAAO,CAACO,IAAAA,iCAA0B,EAACT,0BAAmB;QAC1D;QAEAN,IAAAA,YAAI,EAAC,0CAA0C;YAC7C,MAAMS,QAAQ;YAEd,MAAMC,+BAA+BC,MAAMC,IAAI,CAC7C;gBAAEC,QAAQJ;YAAM,GAChB,IAAMK,yBAAkB;YAG1BvB,UAAE,CAACY,KAAK,CAACvB,mBAAmB,aAAawB,eAAe,CACtDC,IAAAA,QAAE,EAACU,IAAAA,iCAA0B,EAACL;YAGhCT,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBc,SAAS,CAAC,OAAO;gBAAEgB;YAAM,KACnED,OAAO,CAACO,IAAAA,iCAA0B,EAACL;QACvC;IACF;IAEAhC,IAAAA,gBAAQ,EAAC,aAAa;QACpBsB,IAAAA,YAAI,EAAC,yBAAyB;YAC5BT,UAAE,CAACY,KAAK,CAACvB,mBAAmB,aAAawB,eAAe,CACtDC,IAAAA,QAAE,EAACW,oBAAa;YAGlBf,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBe,SAAS,CAAC,OAAO,CAAC,KAC5Dc,OAAO,CAACQ,oBAAa;QACzB;QAEAhB,IAAAA,YAAI,EAAC,6CAA6C;YAChD,MAAMS,QAAQ;YAEd,MAAMQ,sBAAsB;gBAC1BC,QAAQP,MAAMC,IAAI,CAAC;oBAAEC,QAAQJ;gBAAM,GAAG,IAAM;YAC9C;YAEAlB,UAAE,CAACY,KAAK,CAACvB,mBAAmB,aAAawB,eAAe,CACtDC,IAAAA,QAAE,EAACY;YAGLhB,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBe,SAAS,CAAC,OAAO;gBAAEe;YAAM,KACnED,OAAO,CAACS;QACZ;IACF;IAEAvC,IAAAA,gBAAQ,EAAC,cAAc;QACrBsB,IAAAA,YAAI,EAAC,0BAA0B;YAC7BT,UAAE,CAACY,KAAK,CAACvB,mBAAmB,cAAcwB,eAAe,CACvDC,IAAAA,QAAE,EAACU,IAAAA,iCAA0B,EAACI,2BAAoB;YAGpDlB,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBgB,UAAU,CAAC,OAAO,CAAC,KAC7Da,OAAO,CAACO,IAAAA,iCAA0B,EAACI,2BAAoB;QAC3D;QAEAnB,IAAAA,YAAI,EAAC,8CAA8C;YACjD,MAAMS,QAAQ;YAEd,MAAMW,gCAAgCT,MAAMC,IAAI,CAC9C;gBAAEC,QAAQJ;YAAM,GAChB,IAAMY,0BAAmB;YAG3B9B,UAAE,CAACY,KAAK,CAACvB,mBAAmB,cAAcwB,eAAe,CACvDC,IAAAA,QAAE,EAACU,IAAAA,iCAA0B,EAACK;YAGhCnB,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBgB,UAAU,CAAC,OAAO;gBAAEc;YAAM,KACpED,OAAO,CAACO,IAAAA,iCAA0B,EAACK;QACvC;IACF;IAEApB,IAAAA,YAAI,EAAC,qBAAqB;QACxBT,UAAE,CAACY,KAAK,CAACvB,mBAAmB,UAAUwB,eAAe,CACnDC,IAAAA,QAAE,EAACgB,0BAAmB;QAGxBpB,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBiB,MAAM,CAAC,OAAO,SACxDY,OAAO,CAACa,0BAAmB;IAC/B;IAEArB,IAAAA,YAAI,EAAC,uBAAuB;QAC1BT,UAAE,CAACY,KAAK,CAACvB,mBAAmB,YAAYwB,eAAe,CAACC,IAAAA,QAAE,EAACiB,mBAAY;QAEvErB,IAAAA,cAAM,EAAC,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBkB,QAAQ,CAAC,SAASW,OAAO,CACxEc,mBAAY;IAEhB;AACF"}