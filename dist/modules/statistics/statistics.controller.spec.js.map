{"version":3,"sources":["../../../src/modules/statistics/statistics.controller.spec.ts"],"sourcesContent":["import { test, describe, expect, beforeEach, vi } from 'vitest'\nimport { Test, TestingModule } from '@nestjs/testing'\nimport { firstValueFrom, of } from 'rxjs'\n\nimport { StatisticsController } from './statistics.controller'\nimport { StatisticsService } from './statistics.service'\n\nimport {\n  analysisMock,\n  formattedArtistMock,\n  formattedArtistsMock,\n  formattedTrackMock,\n  topGenresMock,\n} from '@common/mocks'\n\ndescribe('StatisticsController', () => {\n  let statisticsController: StatisticsController\n  let statisticsService: StatisticsService\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        StatisticsController,\n        {\n          provide: StatisticsService,\n          useValue: {\n            lastTracks: vi.fn(),\n            topTracks: vi.fn(),\n            topGenres: vi.fn(),\n            topArtists: vi.fn(),\n            artist: vi.fn(),\n            analysis: vi.fn(),\n          },\n        },\n      ],\n    }).compile()\n\n    statisticsController =\n      module.get<StatisticsController>(StatisticsController)\n    statisticsService = module.get<StatisticsService>(StatisticsService)\n  })\n\n  test('should be defined', () => {\n    expect(statisticsController).toBeDefined()\n  })\n\n  describe('LastTracks', () => {\n    test('should query last tracks', async () => {\n      vi.spyOn(statisticsService, 'lastTracks').mockReturnValue(\n        of([formattedTrackMock])\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.lastTracks('awd', {}))\n      ).toEqual([formattedTrackMock])\n    })\n\n    test('should query last tracks with limit argument', async () => {\n      const limit = 20\n\n      const formattedTrackWithLimitMock = Array.from(\n        { length: limit },\n        () => formattedTrackMock\n      )\n\n      vi.spyOn(statisticsService, 'lastTracks').mockReturnValue(\n        of(formattedTrackWithLimitMock)\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.lastTracks('awd', { limit }))\n      ).toEqual(formattedTrackWithLimitMock)\n    })\n  })\n\n  describe('TopTracks', () => {\n    test('should query top tracks', async () => {\n      vi.spyOn(statisticsService, 'topTracks').mockReturnValue(\n        of([formattedTrackMock])\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.topTracks('awd', {}))\n      ).toEqual([formattedTrackMock])\n    })\n\n    test('should query top tracks with limit argument', async () => {\n      const limit = 20\n\n      const formattedTrackWithLimitMock = Array.from(\n        { length: limit },\n        () => formattedTrackMock\n      )\n\n      vi.spyOn(statisticsService, 'topTracks').mockReturnValue(\n        of(formattedTrackWithLimitMock)\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.topTracks('awd', { limit }))\n      ).toEqual(formattedTrackWithLimitMock)\n    })\n  })\n\n  describe('TopGenres', () => {\n    test('should query top genres', async () => {\n      vi.spyOn(statisticsService, 'topGenres').mockReturnValue(\n        of(topGenresMock)\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.topGenres('awd', {}))\n      ).toEqual(topGenresMock)\n    })\n\n    test('should query top genres with limit argument', async () => {\n      const limit = 20\n\n      const genresWithLimitMock = {\n        genres: Array.from({ length: limit }, () => 'genre'),\n      }\n\n      vi.spyOn(statisticsService, 'topGenres').mockReturnValue(\n        of(genresWithLimitMock)\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.topGenres('awd', { limit }))\n      ).toEqual(genresWithLimitMock)\n    })\n  })\n\n  describe('TopArtists', () => {\n    test('should query top artists', async () => {\n      vi.spyOn(statisticsService, 'topArtists').mockReturnValue(\n        of(formattedArtistsMock)\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.topArtists('awd', {}))\n      ).toEqual(formattedArtistsMock)\n    })\n\n    test('should query top artists with limit argument', async () => {\n      const limit = 20\n\n      const formattedArtistsWithLimitMock = Array.from(\n        { length: limit },\n        () => formattedArtistMock\n      )\n\n      vi.spyOn(statisticsService, 'topArtists').mockReturnValue(\n        of(formattedArtistsWithLimitMock)\n      )\n\n      expect(\n        await firstValueFrom(statisticsController.topArtists('awd', { limit }))\n      ).toEqual(formattedArtistsWithLimitMock)\n    })\n  })\n\n  test('should query artist', async () => {\n    vi.spyOn(statisticsService, 'artist').mockReturnValue(\n      of(formattedArtistMock)\n    )\n\n    expect(\n      await firstValueFrom(statisticsController.artist('awd', '123'))\n    ).toEqual(formattedArtistMock)\n  })\n\n  test('should get analysis', async () => {\n    vi.spyOn(statisticsService, 'analysis').mockReturnValue(of(analysisMock))\n\n    expect(await firstValueFrom(statisticsController.analysis('awd'))).toEqual(\n      analysisMock\n    )\n  })\n})\n"],"names":["describe","statisticsController","statisticsService","beforeEach","module","Test","createTestingModule","providers","StatisticsController","provide","StatisticsService","useValue","lastTracks","vi","fn","topTracks","topGenres","topArtists","artist","analysis","compile","get","test","expect","toBeDefined","spyOn","mockReturnValue","of","formattedTrackMock","firstValueFrom","toEqual","limit","formattedTrackWithLimitMock","Array","from","length","topGenresMock","genresWithLimitMock","genres","formattedArtistsMock","formattedArtistsWithLimitMock","formattedArtistMock","analysisMock"],"mappings":";;;;wBAAuD;yBACnB;sBACD;sCAEE;mCACH;uBAQ3B;AAEPA,IAAAA,gBAAQ,EAAC,wBAAwB;IAC/B,IAAIC;IACJ,IAAIC;IAEJC,IAAAA,kBAAU,EAAC;QACT,MAAMC,SAAwB,MAAMC,aAAI,CAACC,mBAAmB,CAAC;YAC3DC,WAAW;gBACTC,0CAAoB;gBACpB;oBACEC,SAASC,oCAAiB;oBAC1BC,UAAU;wBACRC,YAAYC,UAAE,CAACC,EAAE;wBACjBC,WAAWF,UAAE,CAACC,EAAE;wBAChBE,WAAWH,UAAE,CAACC,EAAE;wBAChBG,YAAYJ,UAAE,CAACC,EAAE;wBACjBI,QAAQL,UAAE,CAACC,EAAE;wBACbK,UAAUN,UAAE,CAACC,EAAE;oBACjB;gBACF;aACD;QACH,GAAGM,OAAO;QAEVnB,uBACEG,OAAOiB,GAAG,CAAuBb,0CAAoB;QACvDN,oBAAoBE,OAAOiB,GAAG,CAAoBX,oCAAiB;IACrE;IAEAY,IAAAA,YAAI,EAAC,qBAAqB;QACxBC,IAAAA,cAAM,EAACtB,sBAAsBuB,WAAW;IAC1C;IAEAxB,IAAAA,gBAAQ,EAAC,cAAc;QACrBsB,IAAAA,YAAI,EAAC,4BAA4B;YAC/BT,UAAE,CAACY,KAAK,CAACvB,mBAAmB,cAAcwB,eAAe,CACvDC,IAAAA,QAAE,EAAC;gBAACC,yBAAkB;aAAC;YAGzBL,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBW,UAAU,CAAC,OAAO,CAAC,KAC7DkB,OAAO,CAAC;gBAACF,yBAAkB;aAAC;QAChC;QAEAN,IAAAA,YAAI,EAAC,gDAAgD;YACnD,MAAMS,QAAQ;YAEd,MAAMC,8BAA8BC,MAAMC,IAAI,CAC5C;gBAAEC,QAAQJ;YAAM,GAChB,IAAMH,yBAAkB;YAG1Bf,UAAE,CAACY,KAAK,CAACvB,mBAAmB,cAAcwB,eAAe,CACvDC,IAAAA,QAAE,EAACK;YAGLT,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBW,UAAU,CAAC,OAAO;gBAAEmB;YAAM,KACpED,OAAO,CAACE;QACZ;IACF;IAEAhC,IAAAA,gBAAQ,EAAC,aAAa;QACpBsB,IAAAA,YAAI,EAAC,2BAA2B;YAC9BT,UAAE,CAACY,KAAK,CAACvB,mBAAmB,aAAawB,eAAe,CACtDC,IAAAA,QAAE,EAAC;gBAACC,yBAAkB;aAAC;YAGzBL,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBc,SAAS,CAAC,OAAO,CAAC,KAC5De,OAAO,CAAC;gBAACF,yBAAkB;aAAC;QAChC;QAEAN,IAAAA,YAAI,EAAC,+CAA+C;YAClD,MAAMS,QAAQ;YAEd,MAAMC,8BAA8BC,MAAMC,IAAI,CAC5C;gBAAEC,QAAQJ;YAAM,GAChB,IAAMH,yBAAkB;YAG1Bf,UAAE,CAACY,KAAK,CAACvB,mBAAmB,aAAawB,eAAe,CACtDC,IAAAA,QAAE,EAACK;YAGLT,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBc,SAAS,CAAC,OAAO;gBAAEgB;YAAM,KACnED,OAAO,CAACE;QACZ;IACF;IAEAhC,IAAAA,gBAAQ,EAAC,aAAa;QACpBsB,IAAAA,YAAI,EAAC,2BAA2B;YAC9BT,UAAE,CAACY,KAAK,CAACvB,mBAAmB,aAAawB,eAAe,CACtDC,IAAAA,QAAE,EAACS,oBAAa;YAGlBb,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBe,SAAS,CAAC,OAAO,CAAC,KAC5Dc,OAAO,CAACM,oBAAa;QACzB;QAEAd,IAAAA,YAAI,EAAC,+CAA+C;YAClD,MAAMS,QAAQ;YAEd,MAAMM,sBAAsB;gBAC1BC,QAAQL,MAAMC,IAAI,CAAC;oBAAEC,QAAQJ;gBAAM,GAAG,IAAM;YAC9C;YAEAlB,UAAE,CAACY,KAAK,CAACvB,mBAAmB,aAAawB,eAAe,CACtDC,IAAAA,QAAE,EAACU;YAGLd,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBe,SAAS,CAAC,OAAO;gBAAEe;YAAM,KACnED,OAAO,CAACO;QACZ;IACF;IAEArC,IAAAA,gBAAQ,EAAC,cAAc;QACrBsB,IAAAA,YAAI,EAAC,4BAA4B;YAC/BT,UAAE,CAACY,KAAK,CAACvB,mBAAmB,cAAcwB,eAAe,CACvDC,IAAAA,QAAE,EAACY,2BAAoB;YAGzBhB,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBgB,UAAU,CAAC,OAAO,CAAC,KAC7Da,OAAO,CAACS,2BAAoB;QAChC;QAEAjB,IAAAA,YAAI,EAAC,gDAAgD;YACnD,MAAMS,QAAQ;YAEd,MAAMS,gCAAgCP,MAAMC,IAAI,CAC9C;gBAAEC,QAAQJ;YAAM,GAChB,IAAMU,0BAAmB;YAG3B5B,UAAE,CAACY,KAAK,CAACvB,mBAAmB,cAAcwB,eAAe,CACvDC,IAAAA,QAAE,EAACa;YAGLjB,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBgB,UAAU,CAAC,OAAO;gBAAEc;YAAM,KACpED,OAAO,CAACU;QACZ;IACF;IAEAlB,IAAAA,YAAI,EAAC,uBAAuB;QAC1BT,UAAE,CAACY,KAAK,CAACvB,mBAAmB,UAAUwB,eAAe,CACnDC,IAAAA,QAAE,EAACc,0BAAmB;QAGxBlB,IAAAA,cAAM,EACJ,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBiB,MAAM,CAAC,OAAO,SACxDY,OAAO,CAACW,0BAAmB;IAC/B;IAEAnB,IAAAA,YAAI,EAAC,uBAAuB;QAC1BT,UAAE,CAACY,KAAK,CAACvB,mBAAmB,YAAYwB,eAAe,CAACC,IAAAA,QAAE,EAACe,mBAAY;QAEvEnB,IAAAA,cAAM,EAAC,MAAMM,IAAAA,oBAAc,EAAC5B,qBAAqBkB,QAAQ,CAAC,SAASW,OAAO,CACxEY,mBAAY;IAEhB;AACF"}