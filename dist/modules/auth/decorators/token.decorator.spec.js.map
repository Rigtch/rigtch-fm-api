{"version":3,"sources":["../../../../src/modules/auth/decorators/token.decorator.spec.ts"],"sourcesContent":["import { test, describe, expect, vi } from 'vitest'\nimport { ExecutionContext, UnauthorizedException } from '@nestjs/common'\nimport { mock } from 'vitest-mock-extended'\n\nimport { Token } from './token.decorator'\n\nimport { getParameterDecoratorFactory } from '~/utils'\n\ndescribe('AccessToken', () => {\n  const factory = getParameterDecoratorFactory(Token)\n\n  test('should be defined', () => {\n    expect(Token).toBeDefined()\n  })\n\n  test('should return the access token from header', () => {\n    const accessToken = 'test'\n\n    expect(\n      factory(\n        undefined,\n        mock<ExecutionContext>({\n          switchToHttp: vi.fn().mockReturnValue({\n            getRequest: vi.fn().mockReturnValue({\n              headers: {\n                authorization: `Bearer ${accessToken}`,\n              },\n            }),\n          }),\n          getType: vi.fn().mockReturnValue('http'),\n        })\n      )\n    ).toEqual(accessToken)\n  })\n\n  test('should throw unauthorized exception if no access token is provided', () => {\n    expect(() =>\n      factory(\n        undefined,\n        mock<ExecutionContext>({\n          switchToHttp: vi.fn().mockReturnValue({\n            getRequest: vi.fn().mockReturnValue({}),\n          }),\n          getType: vi.fn().mockReturnValue('http'),\n        })\n      )\n    ).toThrowError(UnauthorizedException)\n  })\n})\n"],"names":["describe","factory","getParameterDecoratorFactory","Token","test","expect","toBeDefined","accessToken","undefined","mock","switchToHttp","vi","fn","mockReturnValue","getRequest","headers","authorization","getType","toEqual","toThrowError","UnauthorizedException"],"mappings":";;;;wBAA2C;wBACa;oCACnC;gCAEC;uBAEuB;AAE7CA,IAAAA,gBAAQ,EAAC,eAAe;IACtB,MAAMC,UAAUC,IAAAA,mCAA4B,EAACC,qBAAK;IAElDC,IAAAA,YAAI,EAAC,qBAAqB;QACxBC,IAAAA,cAAM,EAACF,qBAAK,EAAEG,WAAW;IAC3B;IAEAF,IAAAA,YAAI,EAAC,8CAA8C;QACjD,MAAMG,cAAc;QAEpBF,IAAAA,cAAM,EACJJ,QACEO,WACAC,IAAAA,wBAAI,EAAmB;YACrBC,cAAcC,UAAE,CAACC,EAAE,GAAGC,eAAe,CAAC;gBACpCC,YAAYH,UAAE,CAACC,EAAE,GAAGC,eAAe,CAAC;oBAClCE,SAAS;wBACPC,eAAe,CAAC,OAAO,EAAET,YAAY,CAAC;oBACxC;gBACF;YACF;YACAU,SAASN,UAAE,CAACC,EAAE,GAAGC,eAAe,CAAC;QACnC,KAEFK,OAAO,CAACX;IACZ;IAEAH,IAAAA,YAAI,EAAC,sEAAsE;QACzEC,IAAAA,cAAM,EAAC,IACLJ,QACEO,WACAC,IAAAA,wBAAI,EAAmB;gBACrBC,cAAcC,UAAE,CAACC,EAAE,GAAGC,eAAe,CAAC;oBACpCC,YAAYH,UAAE,CAACC,EAAE,GAAGC,eAAe,CAAC,CAAC;gBACvC;gBACAI,SAASN,UAAE,CAACC,EAAE,GAAGC,eAAe,CAAC;YACnC,KAEFM,YAAY,CAACC,6BAAqB;IACtC;AACF"}